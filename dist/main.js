$(function(){$("#testclick").click(function(){console.log("flipped"),toggleClass("flipped")})}),console.log("hi");var app=angular.module("NowPlaying",[]),defaultImgURL="http://4.bp.blogspot.com/-hIirVYTQFRs/TwdWvcq55uI/AAAAAAAACt8/3frSkQULrn4/s320/film-reel.jpg";app.controller("mainCtrl",function($scope,xbmcFactory,tmdbFactory,configuration){$scope.curMovie={},$scope.curMovie.title="",$scope.curMovie.idx=0,$scope.img={},$scope.img={url:defaultImgURL},$scope.tmdbImgPath=tmdbFactory.getImagePath(),configuration.initialize(),$scope.setCurMovie=function(title){$scope.curMovie.title=title},$scope.setImg=function(url){$scope.img.url=url};var promise=xbmcFactory.getMovieCache();promise.then(function(movieCache){$scope.cache=movieCache})}),app.controller("profileCtrl",function($scope,rottenTomatoesFactory,tmdbFactory){$scope.test=function(){console.log("test"),$scope.flipper=1==$scope.flipper?0:1},$scope.profile={},$scope.profile.img={url:defaultImgURL},$scope.$watch("curMovie.title",function(nv,ov){if(nv!=ov){var promise=rottenTomatoesFactory.getMovie($scope.curMovie.title);promise.then(function(movieInfo){$scope.rt=movieInfo,$scope.profile.img={url:movieInfo.movies[0].posters.original}},function(reason){alert("Failed: "+reason)});var promise2=tmdbFactory.getMovie($scope.curMovie.title);promise2.then(function(movieInfo){$scope.setImg($scope.tmdbImgPath+movieInfo.results[0].poster_path)},function(reason){alert("Failed: "+reason)})}}),$(document).ready(function(){$("#card");console.log("ready")})}),app.controller("MovieListCtrl",function($scope,$location,$anchorScroll,xbmcFactory){xbmcFactory.setupBookmarks($scope);var promise=xbmcFactory.getMovies();promise.then(function(movieData){$scope.data=movieData}),$scope.selectMovie=function(idx,title){$scope.setCurMovie(title),$scope.selectedRow=idx},$scope.highlightMovie=function(idx){$scope.highlightedRow=idx},$scope.leaveMovieList=function(){$scope.highlightedRow="noHighlightedRow"},$scope.jumpToBM=function(bm){"#"==bm&&(bm="firstMovie");var pos=$("."+bm).position().top-$("#movie0").position().top;$("#movieList").animate({scrollTop:pos},2500)},$scope.getFlags=function(xbmcId){return $scope.cache[xbmcId]?!0:!1}}),app.service("configuration",function(xbmcFactory,tmdbFactory){this.sayHello=function(){return"Hello, World!"},this.initialize=function(){var i=0,configArr=[],promise=xbmcFactory.getMovies();promise.then(function(xbmcList){$.each(xbmcList,function(){configArr[this.movieId]=this;var that=this;if(i++>3)return!1;var promise=tmdbFactory.getMovie(this.title);promise.then(function(tmdbMovie){configArr[that.movieId].tmdb=tmdbMovie})})})}}),app.factory("xbmcFactory",function($q,$http){return{getMovies:function(){var deferred=$q.defer();return $http.get("../xbmc/php/movies_2.json").then(function(d){var movieData=addBookmarks(d.data.result.movies);deferred.resolve(angular.fromJson(movieData))}),deferred.promise},setupBookmarks:function(scope){scope.alphabet=["#","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","R","S","T","U","V","W","X","Y","Z"]},getMovieCache:function(){var deferred=$q.defer();return $http.get("../xbmc/php/movieCache.json").then(function(d){var movieCache=[];$.each(d.data.result.movies,function(){movieCache[this.xbmcId]=[],movieCache[this.xbmcId].tmdbId=this.tmdbId}),deferred.resolve(movieCache)}),deferred.promise}}}),app.factory("rottenTomatoesFactory",function($q,$http){var rtLinks={getMovie:"http://api.rottentomatoes.com/api/public/v1.0/movies.json?apikey=jq7aydjmufspr54dcffw7f66&q=[movietitle]&page_limit=1&callback=JSON_CALLBACK"};return{getMovie:function(movie){var deferred=$q.defer(),findMovie=rtLinks.getMovie.replace("[movietitle]",movie);return $http.jsonp(findMovie).then(function(d){0==d.data.total&&(d.data.movies[0].posters.original=defaultImgURL),console.log(d.data.total),deferred.resolve(d.data)}),deferred.promise}}}),app.factory("tmdbFactory",function($q,$http){var tmdbLinks={getMovieByName:"http://api.themoviedb.org/3/search/movie?api_key=829f2c4b8c9c5304ea86fc7cf47b1053&query=[movietitle]&callback=JSON_CALLBACK"};return{getMovie:function(movie){var deferred=$q.defer(),findMovie=tmdbLinks.getMovieByName.replace("[movietitle]",movie.replace(" ","+"));return $http.jsonp(findMovie).then(function(d){deferred.resolve(d.data)}),deferred.promise},getImagePath:function(){return"http://d3gtl9l2a4fn1j.cloudfront.net/t/p/original/"},addTmdbToXbmc:function(xbmcList){$q.defer();$.each(xbmcList,function(){var promise=tmdbFactory.getMovie("taken");promise.then(function(){}),getMovie("taken")})}}}),app.directive("NOT_USED_mySelectFirstMovie",function(){return function(scope,element){scope.$first&&element.addClass("xxxxxxx")}}),app.directive("bnFadeHelper",function(){function compile(element){return element.prepend("<img class='fader' />"),link}function link($scope,element){function initFade(fadeSource){fader.prop("src",fadeSource).addClass("show"),primary.one("load",startFade)}function isFading(){return fader.hasClass("show")||fader.hasClass("fadeOut")}function startFade(){fader.width(),fader.addClass("fadeOut"),setTimeout(teardownFade,250)}function teardownFade(){fader.removeClass("show fadeOut")}var fader=element.find("img.fader"),primary=element.find("img.image");$scope.$watch("profile.img.url",function(newValue,oldValue){newValue!==oldValue&&(isFading()||initFade(oldValue))})}return{compile:compile,restrict:"A"}});